@{
    ViewBag.Title = "Listener";
}
<h2>@ViewBag.Title.</h2>

<hr />

<div class="col-md-12">
    <div id="vehiclesNotifications"></div>
</div>

@section Scripts{
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script type="text/javascript">
        $(function () {
            // Declare a proxy to reference the hub.
            var vehiclesNotificationsHub = $.connection.VehiclesHub;

            //debugger;
            // Create a function that the hub can call to broadcast messages.
            vehiclesNotificationsHub.client.UpdateData = function () {
                getAllVehiclesNotifications()

            };
            // Start the connection.
            $.connection.hub.start().done(function () {
                getAllVehiclesNotifications();
            }).fail(function (e) {
                alert(e);
            });
        });


        function getAllVehiclesNotifications() {

            $("#vehiclesNotifications").jsGrid({
                height: 300,
                width: "100%",

                autoload: true,
                controller: {
                    loadData: function (filter) {
                        return $.ajax({
                            type: "GET",
                            url: 'http://localhost:17645/API/Vehicle/Get',
                            dataType: "json",
                            headers: { Authorization: "Bearer " + sessionStorage.getItem("accessToken") },
                        });
                    },
                },
                fields: [
                    { name: "CustomerName", title: "Customer Name", type: "text" },
                    { name: "RegistrationNo", title: "Registration No", type: "text" },
                    { name: "VehicleId", title: "Vehicle Id", type: "text" },
                    {
                        name: "VehicleStatus", itemTemplate: function (value) {
                            if (value == "1") {
                                return "<i class='fa fa-truck fa-lg text-success' aria-hidden='true'></i>";
                            }
                            else if (value == "2") {
                                return "<i class='fa fa-truck fa-lg text-danger' aria-hidden='true'></i>";
                            }

                            return "<i class='fa fa-truck fa-lg text-default' aria-hidden='true'></i>";

                        }, title: "Vehicle Status", type: "text", width: 50
                    }
                ]
            });
        }
    </script>
}